.. _rm-install-query-runner:

====================
Install Query Runner
====================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

To use Query Converter Test Bench, Relational
Migrator must have access to the Query Runner. 
Query Runner is a Docker container with 
all the dependencies needed to test your converted 
queries.

About this Task
---------------

- Query Runner operates on the ``http`` protocol and 
  is not encrypted. All data is processed within the 
  container and no connection details or sensitive data 
  is exposed during the Query Runner connection process.

- Query Runner either locally or remotely. This task contains
  instructions for installing the container locally. 

Before you Begin
----------------

Install `Docker <https://www.docker.com/get-started/>`__.

Steps
-----

.. procedure::
   :style: normal

   .. step:: Get the Query Runner Image
      
      .. code-block:: sh

         docker pull public.ecr.aws/v4d7k6c9/relational-migrator-query-runner

   .. step:: Run the Image as a Container

      To run the container locally:

      .. code-block:: sh

         docker run --name relational-migrator-query-runner -p 6080:6080 public.ecr.aws/v4d7k6c9/relational-migrator-query-runner

      To run the container remotely:
      
      You can optionally run Query Runner on a remote host. To 
      do this edit the ``user.properties`` file and edit the 
      ``migrator.language-runner.server.address`` configuration
      and add the server address the service is running at.

      For example:

      .. code-block:: sh

         migrator.language-runner.server.address: http://myserver:6080 
    
    .. tip::
        
        For details on where the ``user.properties`` file is located, 
        see :ref:`file-location`. 

   .. step:: Confirm the Query Runner container is running

      In your web browser navigate to the host/port the Query Runner 
      container is running. For example: 
      `http://localhost:6080/status <http://localhost:6080/status>`__.

      Check the ``status`` field of the JSON data returned from the 
      ``status`` endpoint. A status of ``ok`` means the container is
      running:

      .. code-block:: 
         :copyable: false

         {
         "status":"ok",
         "server":"App Mod Language Runner",
         "commitHash":"159119004c2bf8c534e15e5895acb9bc1bfb5b8d",
         "version":"20240627"
         }

Next Steps
----------

- :ref:`rm-compare-converted-queries`
