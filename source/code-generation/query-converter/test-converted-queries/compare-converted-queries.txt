.. _rm-compare-converted-queries

=========================
Compare Converted Queries
=========================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can use the :guilabel:`Test Queries` pane to compare source 
and destination queries, views, and stored procedure results 
inside of Relational Migrator. The :guilabel:`Test Queries` can 
help you verify the accuracy of converted code and
show the source and destination data after you run a sync job.

Before you Begin
----------------

- You must sign in to your Atlas account in Relational Migrator. 
  For details, see :ref:`rm-atlas-log-in`.

- For details on how to turn on Query Converter, see 
  :ref:`rm-enable-query-converter`.

- To use the :guilabel:`Test Queries` pane, Relational
  Migrator must have access to the Query Runner. For details
  on how to setup Query Runner, see :ref:`rm-install-query-runner`.

Steps
-----

.. procedure::
   :style: normal

   .. step:: Select a query on the :guilabel:`Query Converter` pane

      a. From the :guilabel:`Code Generation` tab, click the 
         :guilabel:`Query Converter` pane.

         .. note::

           If you are not already logged into your Atlas account or have
           an expired session, you must login to proceed.

      #. On the left-hand :guilabel:`Queries` pane, select a query, view,
         or stored procedure.

   .. step:: Open the :guilabel:`Test Queries` pane

      a. From the :guilabel:`Code Generation` tab, click the 
         :guilabel:`Query Converter` pane.

      #. Click the :icon-lg:`ChevronUp` on the :guilabel:`Test Queries`
         pane at the bottom-right of the screen.

   .. step:: (Optional) Specify parameters

      If your converting a stored procedure, specify the 
      stored procedure's parameters in the 
      :guilabel:`Source Script` text field.

      For example, for the following PostGreSQL stored procedure:

      .. code-block:: sql
         :copyable: false

         CREATE OR REPLACE PROCEDURE PUBLIC.CANCEL_CUSTOMER_ORDERS(IN CUST_ID INTEGER)
         LANGUAGE PLPQSQL

         AS $PROCEDURE$
         BEGIN 
            UPDATE ORDERS SET STATUS = 'CANCELLED' WHERE CUSTOMER_ID = CUST_ID;
         END;$PROCEDURE$

      Specify the ``CUST_ID`` in the :guilabel:`Source Script` text field
      by replacing ``<value>`` with the customer ID:

      .. code-block:: sql
         :copyable: false
         :emphasize-lines: 7

         DO 
         $$
            DECLARE
               CUST_ID INTEGER;
            BEGIN
               --TODO: Set parameter values here
               CUST_ID := <value>

               CALL public.cancel_customer_orders(cust_id);
            END;
         $$  

   .. step:: Run the source query

      a. On the :guilabel:`Test Queries`
         pane, click the :guilabel:`Run Source Query` 
         button.

      #. Enter the connection details to your source database.

      #. Click :guilabel:`Run` on the 
         :guilabel:`Connection Details` form.

         The data from the source database populates in 
         :guilabel:`Results`. You can click the :guilabel:`Messages` 
         pill to see execution statistics such as ``Execution Time``
         and ``Row Count``.
      
   .. step:: Run the converted query

      a. On the :guilabel:`Test Queries`
         pane, click :guilabel:`Run Converted Query` 
         button.

      #. Enter the connection details to your database.

      #. Click :guilabel:`Run` on the 
         :guilabel:`Connection Details` form.

         The data from the destination database populates 
         on the right-side of :guilabel:`Results`.

         .. note::

            You can click the :icon-lg:`Menu` and 
            :icon-lg:`Apps` buttons to switch between 
            the document and row view for the data. 

   .. step:: Compare the results of the source and destination queries

            a. You can use the :guilabel:`Results` pane to compare the 
               source and destination data and types.

            #. Click the :guilabel:`Messages` pill to compare source 
               and destination query statistics.

   .. step:: (Optional) Edit the converted code

            If the destination query needs to be changed, you can make 
            code changes in the :guilabel:`Converted MongoDB Query`
            pane and run the updated query and view the results.
            
            a. Click the :icon-lg:`Edit` on the :guilabel:`Converted MongoDB Query` pane
            
            #. Edit the code
            
            #. Click :guilabel:`Save`
            
            #. Click :guilabel:`Run Converted Query`


Learn More
----------

- :ref:`rm-convert-queries`
- :ref:`rm-convert-views`
- :ref:`rm-convert-stored-procedures`
