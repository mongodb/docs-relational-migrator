
.. _rm-save-mongodb-connection:

============================================
Save a MongoDB Connection
============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

To start a migration job, Relational Migrator must connect to your MongoDB
database using an account with :authrole:`readWrite` access. You can save a new
MongoDB connection from the Relational Migrator :guilabel:`Connections` page,
or when creating or modifying a data migration job.

Before you Begin
----------------

- To save a connection to a MongoDB Atlas cluster, you must be :ref:`logged in
  <rm-atlas-log-in>` with Atlas.

- For both Atlas and on-premises deployments, we recommend creating a separate
  :ref:`MongoDB user <rm-mongodb-service-user>` for Relational Migrator.

Steps
-----

.. procedure::

   .. step:: Add a new connection
      
      In the list of :guilabel:`MongoDB` connections, click :guilabel:`+ Add connection`.

   .. step:: Enter connection information

      If you are using MongoDB Atlas, you can select your Atlas cluster 
      from the :guilabel:`Select a cluster` list, or you can enter the
      :manual:`connection string <mongodb-uri>`.

      If you are using an on-premises deployment, you must use the MongoDB
      connection string.

      .. tabs::

         .. tab:: Select a cluster
            :tabid: select-atlas-cluster
            
            a. Select the cluster.
            
               Clusters are displayed in a three-level hierarchy: 
               :guilabel:`Organization` > :guilabel:`Project` >
               :guilabel:`Cluster`, organized alphabetically. Only the first 100 clusters you are authorized to access are shown.

            #. If it isn't included in the connection string, enter the
               :guilabel:`Database` to connect to.
            
            #. If they aren't included in the connection string, enter the 
               :guilabel:`Username` and :guilabel:`Password` of your
               :ref:`Relational Migrator MongoDB user <rm-mongodb-service-user>`.
               
               Checking :guilabel:`Save password` saves the password securely
               on your machine. Relational Migrator automatically fills in the 
               :guilabel:`Password` field on future uses.

            If you leave any of the form fields for :guilabel:`Database`,
            :guilabel:`Username`, or :guilabel:`Password` blank, Relational
            Migrator uses the values from the Atlas cluster metadata.

         .. tab:: Enter MongoDB URI
            :tabid: enter-mongodb-uri

            a. In the :guilabel:`MongoDB connection string (URI)` field, input
               your :manual:`MongoDB URI <mongodb-uri>`.

            #. If it isn't included in the connection string, enter the
               :guilabel:`Database` to connect to.
            
            #. If they aren't included in the connection string, enter the 
               :guilabel:`Username` and :guilabel:`Password` of your
               :ref:`Relational Migrator MongoDB user <rm-mongodb-service-user>`.
               
               Checking :guilabel:`Save password` saves the password securely
               on your machine. Relational Migrator automatically fills in the 
               :guilabel:`Password` field on future uses.
            
            If you leave the form :guilabel:`Database`, :guilabel:`Username`, 
            or :guilabel:`Password` fields blank, Relational Migrator uses the
            values from the URI.

   .. step:: Specify a :guilabel:`Connection name` and optional :guilabel:`Environment tag`
         
      Environment tags color code and organize connections for 
      convenience. Leaving the drop-down empty is the same as selecting 
      the "None" tag.

   .. step:: (Optional) Click :guilabel:`Test connection`

      Relational Migrator attempts to authenticate and connect to the
      database.
         
   .. step:: Click :guilabel:`Save`